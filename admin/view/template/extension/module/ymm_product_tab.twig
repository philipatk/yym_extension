<div class="tab-pane" id="tab-ymm">
  <div class="form-group">
    <label class="col-sm-2 control-label" for="input-universal">Universal Product</label>
    <div class="col-sm-10">
      <div class="checkbox">
        <label>
          <input type="checkbox" name="is_universal" value="1" id="input-universal" {% if is_universal %}checked="checked"{% endif %} onclick="$('#ymm-table-container').toggle(!this.checked);" />
          Fits All Vehicles
        </label>
      </div>
    </div>
  </div>

  <div id="ymm-table-container" style="{% if is_universal %}display:none;{% endif %}">
    <div class="table-responsive">
      <table id="ymm-table" class="table table-striped table-bordered table-hover">
        <thead>
          <tr>
            <td class="text-left">Model</td>
            <td class="text-left">Start Year</td>
            <td class="text-left">End Year</td>
            <td></td>
          </tr>
        </thead>
        <tbody>
          {% set ymm_row = 0 %}
          {% if product_ymm %}
          {% for ymm in product_ymm %}
          <tr id="ymm-row{{ ymm_row }}">
            <td class="text-left">
              {{ ymm.model_name }}
              <input type="hidden" name="product_ymm[{{ ymm_row }}][model_id]" value="{{ ymm.model_id }}" />
            </td>
            <td class="text-left"><input type="number" name="product_ymm[{{ ymm_row }}][year_start]" value="{{ ymm.year_start }}" class="form-control" /></td>
            <td class="text-left"><input type="number" name="product_ymm[{{ ymm_row }}][year_end]" value="{{ ymm.year_end }}" class="form-control" /></td>
            <td class="text-left"><button type="button" onclick="$('#ymm-row{{ ymm_row }}').remove();" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>
          </tr>
          {% set ymm_row = ymm_row + 1 %}
          {% endfor %}
          {% endif %}
        </tbody>
        <tfoot>
          <tr>
            <td colspan="3"></td>
            <td class="text-left"><button type="button" onclick="addYmm();" class="btn btn-primary"><i class="fa fa-plus-circle"></i> Add Vehicle</button></td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>

<script type="text/javascript"><!--
var ymm_row = {{ ymm_row }};

function addYmm() {
	var html  = '<tr id="ymm-row' + ymm_row + '">';
	html += '  <td class="text-left"><div style="position: relative;"><input type="text" name="product_ymm[' + ymm_row + '][model]" value="" placeholder="Model" class="form-control" id="input-model' + ymm_row + '" /><input type="hidden" name="product_ymm[' + ymm_row + '][model_id]" value="" /></div></td>';
  html += '  <td class="text-left"><input type="number" step="1" name="product_ymm[' + ymm_row + '][year_start]" value="" placeholder="Start Year" class="form-control" /></td>';
	html += '  <td class="text-left"><input type="number" step="1" name="product_ymm[' + ymm_row + '][year_end]" value="" placeholder="End Year" class="form-control" /></td>';
	html += '  <td class="text-left"><button type="button" onclick="$(\'#ymm-row' + ymm_row + '\').remove();" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>';
	html += '</tr>';

	$('#ymm-table tbody').append(html);

	var current_row = ymm_row;

	// Autocomplete for Model
	$('#input-model' + current_row).autocomplete({
		'source': function(request, response) {
			$.ajax({
				url: 'index.php?route=extension/module/ymm/autocomplete&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request),
				dataType: 'json',
				success: function(json) {
					response($.map(json, function(item) {
						return { label: item['name'], value: item['model_id'] }
					}));
				}
			});
		},
		'select': function(item) {
			$('#input-model' + current_row).val(item['label']);
			$('input[name="product_ymm[' + current_row + '][model_id]"]').val(item['value']);
		}
	});

	ymm_row++;
}
//--></script>